<?xml version="1.0" encoding="UTF-8"?>

<!-- FrameworkAnzeige.wxs
     Hier soll angezeigt werden, ob auf dem Zielrechner die Frameworks
     ".NET Framework 4.8" und ".NET Core 3.1" vorhanden sind.
-->

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension"
     xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Fragment>
    
<!-- WiX-Systemvariable abfragen, die die aktuelle Versionsnummer von .NET Framework 4 enthält
     (z.B. 528040 für .NET Framework 4.8). Erfordert einen Verweis auf NetFxExtension (siehe
     Zeile 10, Verweis muss aber auch in Visual Studio hinzugefügt werden - Menü "Projekt -
     Verweis hinzufügen: C:\Programme\WiX Toolset v3.11\bin\WixNetFxExtension.dll").
-->
    <PropertyRef Id="WIXNETFX4RELEASEINSTALLED"/>
    
<!-- Für die Prüfung auf .NET Core gibt es keine WiX-Systemvariable. Um dessen Existenz auf
     dem Zielrechner festzustellen wird eine CustomAction (also z.B. eine C#-Funktion innerhalb
     einer DLL) benötigt. Siehe auch Kommentare in "Product.wxs".
-->
    
<!-- Hier beginnt die Definition des Dialogfensters.
-->
    <UI Id="MeinFrameworkTestProgramm">
      
<!-- DialogRef-Elemente
     Verweise auf andere Dialogfenster (diese fünf sind Pflicht für alle MSI-Projekte)
-->
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="UserExit" />
      <DialogRef Id="ExitDlg" />
      
<!-- Die Standard-Schriftart muss definiert und mindestens ein TextStyle muss festgelegt werden.
-->
      <Property Id="DefaultUIFont"
                Value="Tahoma_Regular" />
      
      <TextStyle Id="Tahoma_Regular"
                 FaceName="Tahoma"
                 Size="8" />

<!-- Definition des Dialogfensters mit allen Kontroll-Elementen
     (hier nur vier Textfelder und ein OK-Schalter)
-->
      <Dialog Id="FrameworkAnzeigeDialog"
              Width="250"
              Height="100"
              Title="Vorhandene Frameworks"
              NoMinimize="no">

<!-- Hier wird geprüft, ob auf dem Zielrechner .NET Framework 4.8 (oder höher)
     installiert ist. Dazu wird die WiX-Systemvariable WIXNETFX4RELEASEINSTALLED
     abgefragt, deren Wert "#528040" für die Version 4.8 steht.
-->
        <Control Id="Textfeld1"
                 Type="Text"
                 X="10"
                 Y="10"
                 Width="230"
                 Height="10"
                 TabSkip="no"
                 Text=".NET Framework 4.8 vorhanden.">

          <Condition Action="hide">
            <![CDATA[WIXNETFX4RELEASEINSTALLED < "#528040"]]>
          </Condition>
        </Control>

        <Control Id="Textfeld2"
                 Type="Text"
                 X="10"
                 Y="20"
                 Width="230"
                 Height="10"
                 TabSkip="no"
                 Text=".NET Framework 4.8 fehlt.">

          <Condition Action="hide">
            <![CDATA[WIXNETFX4RELEASEINSTALLED >= "#528040"]]>
          </Condition>
        </Control>

<!-- Hier wird geprüft, ob auf dem Zielrechner .NET Core 3.1.14 (oder höher)
     installiert ist. Da es dafür keine WiX-Systemvariable gibt, wurde in "Product.wxs"
     eine eigene Property "DOTNETCORE3114" definiert und eine CustomAction aufgerufen,
     also eine C#-Funktion, die diesen Wert ermittelt und in DOTNETCORE3114 schreibt.
-->
        <Control Id="Textfeld3"
                 Type="Text"
                 X="10"
                 Y="30"
                 Width="230"
                 Height="10"
                 TabSkip="no"
                 Text=".NET Core 3.1.14 vorhanden.">

          <Condition Action="hide">
            <![CDATA[DOTNETCORE3114 = "0"]]>
          </Condition>
        </Control>

        <Control Id="Textfeld4"
                 Type="Text"
                 X="10"
                 Y="40"
                 Width="230"
                 Height="10"
                 TabSkip="no"
                 Text=".NET Core 3.1.14 fehlt.">

          <Condition Action="hide">
            <![CDATA[DOTNETCORE3114 = "1"]]>
          </Condition>
        </Control>

        <Control Id="OkButton"
                 Type="PushButton"
                 Text="OK"
                 X="100"
                 Y="75"
                 Height="17"
                 Width="50">

          <Publish Event="EndDialog"
                   Value="Exit" />
        </Control>

      </Dialog>
    </UI>
    
<!-- InstallUISequence-Element
     An dieser Stelle wird das Installationsprogramm gestartet und das erste
     Dialogfenster angezeigt. Die Anzahl und Reihenfolge der weiteren Dialogfenster
     ergibt sich aus dem Inhalt der Publish-Elemente innerhalb der Control-Elemente.
-->
    <InstallUISequence>

      <Show Dialog="FrameworkAnzeigeDialog"
            Before="ExecuteAction" />

    </InstallUISequence>

  </Fragment>

</Wix>
